<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usuarios - Tester v1.1</title>
    <!-- Libs -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="../../assets/css/base.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar injected by layout.js -->
        <nav id="sidebar-container"></nav>

        <!-- Main Content -->
        <main>
            <header id="header-container"></header>

            <div id="page-content">
                <div class="content-header">
                <!-- Main Tabs: System vs Staff -->
                <div class="tab-container mb-md">
                    <button type="button" class="tab-btn active" data-view="system">Usuarios del Sistema</button>
                    <button type="button" class="tab-btn" data-view="staff">Staff (Credenciales)</button>
                </div>

                <!-- VIEW: SYSTEM USERS -->
                <div id="view-system">
                    <div id="users-tabs" class="tab-container mb-md" style="margin-left: 0; border-bottom: none;">
                        <!-- Sub-tabs for System Users filtering -->
                        <span class="text-xs text-muted mr-sm align-self-center">Filtrar:</span>
                        <button type="button" class="tab-btn active" data-area="all">Todos</button>
                        <button type="button" class="tab-btn" data-area="barra">Barra</button>
                        <button type="button" class="tab-btn" data-area="caja">Caja</button>
                        <button type="button" class="tab-btn" data-area="limpieza">Limpieza</button>
                        <button type="button" class="tab-btn" data-area="seguridad">Seguridad</button>
                        <button type="button" class="tab-btn" data-area="produccion">Produccion</button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3>Listado de Usuarios (Sistema)</h3>
                                <p class="text-muted">Gestiona roles y accesos de administradores y encargados.</p>
                            </div>
                            <div class="card-actions">
                                <div class="search-group">
                                    <input type="text" id="search-users-input" placeholder="Buscar nombre o mail..." autocomplete="off">
                                </div>
                            </div>
                        </div>

                        <div class="table-scroll">
                            <table class="table-compact">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Area</th>
                                        <th>Mail</th>
                                        <th class="text-center">Editar</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body">
                                    <!-- Data loaded via JS -->
                                </tbody>
                            </table>
                        </div>
                        <p class="table-note mt-sm">Usuarios registrados via Google Auth / Correo.</p>
                    </div>
                </div>

                <!-- VIEW: STAFF USERS -->
                <div id="view-staff" class="hidden">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3>Staff Credenciales</h3>
                                <p class="text-muted">Gestiona usuarios simplificados para el staff.</p>
                            </div>
                            <div class="card-actions">
                                <button type="button" class="btn-success" id="btn-create-staff">nuevo Usuario Staff</button>
                            </div>
                        </div>

                        <div class="table-scroll">
                            <table class="table-compact">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Area</th>
                                        <th>Rol</th>
                                        <th>Salario</th>
                                        <th class="text-center">Estado</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="staff-table-body">
                                    <!-- Injected by JS -->
                                </tbody>
                            </table>
                        </div>
                        <p class="table-note mt-sm">Estos usuarios inician sesión con Supabase Auth.</p>
                    </div>
                </div>
            </div>

            <!-- MODAL: PRIVILEGES (SYSTEM) -->
            <div id="modal-privileges" class="modal-overlay hidden" aria-hidden="true">
                <div class="modal-card modal-card-sm">
                    <div class="modal-header">
                        <h3 id="privileges-modal-title">Editar privilegios</h3>
                        <button type="button" class="btn-icon close-modal" data-target="modal-privileges" aria-label="Cerrar">&times;</button>
                    </div>
                    <form id="form-privileges">
                        <div class="form-grid">
                            <div class="form-field span-2">
                                <label for="edit-user-name">Nombre</label>
                                <input type="text" id="edit-user-name" readonly class="input-readonly">
                            </div>
                            <div class="form-field">
                                <label for="edit-user-role">Rol</label>
                                <select id="edit-user-role">
                                    <option value="admin">Admin</option>
                                    <option value="gerencia">Gerencia</option>
                                    <option value="logistica">Logistica</option>
                                    <option value="operativo">Operativo</option>
                                    <option value="encargado barra">Encargado Barra</option>
                                    <option value="staff barra">Staff Barra</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label for="edit-user-area">Area</label>
                                <select id="edit-user-area">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary close-modal" data-target="modal-privileges">Cancelar</button>
                            <button type="submit" class="btn-primary">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- MODAL: STAFF (NEW) -->
            <div id="modal-staff" class="modal-overlay hidden" aria-hidden="true">
                <div class="modal-card modal-card-sm">
                    <div class="modal-header">
                        <h3 id="modal-title-staff">Nuevo Usuario Staff</h3>
                        <button type="button" class="btn-icon close-modal" data-target="modal-staff" aria-label="Cerrar">&times;</button>
                    </div>
                    <form id="form-staff">
                        <div class="form-grid">
                            <div class="form-field span-2">
                                <label for="staff-full-name">Nombre Completo</label>
                                <input type="text" id="staff-full-name" required placeholder="Ej: Juan Perez" autocomplete="name">
                            </div>
                            <div class="form-field span-2">
                                <label for="staff-email">Email</label>
                                <input type="email" id="staff-email" required placeholder="Ej: juan@midnightclub.com" autocomplete="email">
                            </div>
                            <div class="form-field span-2">
                                <label for="staff-password">Contraseña</label>
                                <input type="password" id="staff-password" required placeholder="Min. 6 caracteres">
                            </div>
                            <div class="form-field span-2">
                                <label for="staff-area">Area</label>
                                <select id="staff-area" required>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="form-field span-2">
                                <label for="staff-salary">Salario (por jornada)</label>
                                <input type="number" id="staff-salary" step="0.01" placeholder="0.00">
                            </div>
                        </div>
                         <div class="form-actions">
                            <button type="button" class="btn-secondary close-modal" data-target="modal-staff">Cancelar</button>
                            <button type="submit" class="btn-success">Guardar Staff</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../../assets/js/core/config.js"></script>
    <script src="../../assets/js/layout.js"></script>
    <script src="../../assets/js/modules/auth.js"></script>
    <script src="../../assets/js/modules/master-usuarios.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            if (window.AuthModule) await window.AuthModule.init();
            window.LayoutModule.injectLayout('master-usuarios');
            if (window.MasterUsuariosModule) window.MasterUsuariosModule.init();
        });
    </script>
</body>
</html>
